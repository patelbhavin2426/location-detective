
require('fetch-reply-with');

import React from 'react';
import renderer from 'react-test-renderer';

import { shallow, mount } from "enzyme";

import Enzyme from 'enzyme';
import Adapter from 'enzyme-adapter-react-16';

Enzyme.configure({ adapter: new Adapter() });

import Search from './Search'
import { fetchPlaces }  from '../../services'

describe("Search Component :: ", () => {

    it("should render without throwing an error", () => {
        expect(
            renderer.create(
                <Search/>
            )
        ).not.toBe(null);
    });


    it("should render search inputs UI", () => {

        // Act
        let component = renderer.create(
            <Search />
        ).toJSON();
        // snapshot
        expect(component).toMatchSnapshot();


        // Act
        component = mount(
            <Search />
        );

        // Assert
        expect((component).prop('state')).not.toEqual(null);
        expect(component.find('.location-query').text()).toEqual('');
        expect(component.find('.search-item').text()).toEqual('');
        expect(component.find('.searchbox-submitbtn').text()).toEqual('Search');


    });


    it("should change state with value change in input fields", () => {

        // Act
        let component = mount(
            <Search />
        );

        ////////////
        // Assert
        ////////////

        // basic check
        expect((component).prop('state')).not.toEqual(null);
        expect(component.find('.location-query').text()).toEqual('');
        expect(component.find('.search-item').text()).toEqual('');
        expect(component.find('.searchbox-submitbtn').text()).toEqual('Search');

        // type in the text
        component.find('.location-query').simulate('change', {target: {name: 'zipCode', value: 'Fremont'}});
        expect(component.state('zipCode')).toEqual('Fremont');
        component.find('.search-item').simulate('change', {target: {name: 'searchItem', value: 'food'}});
        expect(component.state('searchItem')).toEqual('food');

    });


    it("let's click on search button input error cases", () => {

        // Act
        let component = mount(
            <Search />
        );

        ////////////
        // Assert
        ////////////

        // basic check
        expect((component).prop('state')).not.toEqual(null);
        expect(component.find('.location-query').text()).toEqual('');
        expect(component.find('.search-item').text()).toEqual('');
        expect(component.find('.searchbox-submitbtn').text()).toEqual('Search');

        // Search with empty inputs
        component.find('button').simulate('click');
        expect(component.state('loading')).toBe(undefined);
        expect(component.state('inputError')).toBe(true);
        expect(component).toMatchSnapshot();

        // Search with empty search-item
        component.find('.search-item').simulate('change', {target: {name: 'searchItem', value: 'food'}});
        component.find('button').simulate('click');
        expect(component.state('loading')).toBe(undefined);
        expect(component.state('inputError')).toBe(true);

        // Search with empty location
        component.find('.location-query').simulate('change', {target: {name: 'zipCode', value: 'San Jose'}});
        component.find('.search-item').simulate('change', {target: {name: 'searchItem', value: ''}});
        component.find('button').simulate('click');
        expect(component.state('loading')).toBe(undefined);
        expect(component.state('inputError')).toBe(true);

    });


    it("let's click on search button", () => {

        // define the response
        const mockSuccessResponse = {"meta":{"code":200,"requestId":"5de69942c546f3001bfcd205"},"response":{"suggestedFilters":{"header":"Tap to show:","filters":[{"name":"$-$$$$","key":"price"},{"name":"Open now","key":"openNow"}]},"geocode":{"what":"","where":"san jose","center":{"lat":37.33939,"lng":-121.89496},"displayString":"San Jose, CA, United States","cc":"US","geometry":{"bounds":{"ne":{"lat":37.469167999999996,"lng":-121.589153},"sw":{"lat":37.125515,"lng":-122.045672}}},"slug":"san-jose-california","longId":"72057594043320107"},"headerLocation":"San Jose","headerFullLocation":"San Jose","headerLocationGranularity":"city","query":"food","totalResults":234,"suggestedBounds":{"ne":{"lat":37.38664414646438,"lng":-121.81915828621537},"sw":{"lat":37.24639071530957,"lng":-122.00272068176893}},"groups":[{"type":"Recommended Places","name":"recommended","items":[{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"592f8c198173cb70120ff91f","name":"Luna Mexican Restaurant","contact":{},"location":{"address":"1495 The Alameda","lat":37.33393480457079,"lng":-121.91517987804323,"labeledLatLngs":[{"label":"display","lat":37.33393480457079,"lng":-121.91517987804323}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1495 The Alameda","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-592f8c198173cb70120ff91f-0"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e6750db152001e1f7122a11","name":"San Pedro Square Market","contact":{},"location":{"address":"87 N San Pedro St","crossStreet":"at W St John St","lat":37.33647957495977,"lng":-121.89440263934547,"labeledLatLngs":[{"label":"display","lat":37.33647957495977,"lng":-121.89440263934547}],"postalCode":"95110","cc":"US","neighborhood":"Downtown San Jose","city":"San Jose","state":"CA","country":"United States","formattedAddress":["87 N San Pedro St (at W St John St)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d120951735","name":"Food Court","pluralName":"Food Courts","shortName":"Food Court","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/shops\/food_foodcourt_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"91053438"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e6750db152001e1f7122a11-1"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4aeb3974f964a520d0bf21e3","name":"Antipastos by De Rose","contact":{},"location":{"address":"3454 McKee Rd","crossStreet":"at Kirk Ave","lat":37.3802689905028,"lng":-121.82750203146779,"labeledLatLngs":[{"label":"display","lat":37.3802689905028,"lng":-121.82750203146779}],"postalCode":"95127","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3454 McKee Rd (at Kirk Ave)","San Jose, CA 95127","United States"]},"categories":[{"id":"4bf58dd8d48988d146941735","name":"Deli \/ Bodega","pluralName":"Delis \/ Bodegas","shortName":"Deli \/ Bodega","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4aeb3974f964a520d0bf21e3-2"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4be9b466b3352d7f464e54d2","name":"Chez Sovan","contact":{},"location":{"address":"923 Oakland Rd","crossStreet":"at Madera Ave.","lat":37.35993556655387,"lng":-121.89130050787494,"labeledLatLngs":[{"label":"display","lat":37.35993556655387,"lng":-121.89130050787494}],"postalCode":"95112","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["923 Oakland Rd (at Madera Ave.)","San Jose, CA 95112","United States"]},"categories":[{"id":"4bf58dd8d48988d142941735","name":"Asian Restaurant","pluralName":"Asian Restaurants","shortName":"Asian","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/asian_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4be9b466b3352d7f464e54d2-3"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"42accc80f964a52051251fe3","name":"Poor House Bistro","contact":{},"location":{"address":"91 S Autumn St","crossStreet":"at W San Fernando St","lat":37.32965001194557,"lng":-121.90043081169512,"labeledLatLngs":[{"label":"display","lat":37.32965001194557,"lng":-121.90043081169512}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["91 S Autumn St (at W San Fernando St)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d17a941735","name":"Cajun \/ Creole Restaurant","pluralName":"Cajun \/ Creole Restaurants","shortName":"Cajun \/ Creole","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/cajun_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"399187","url":"https:\/\/www.grubhub.com\/restaurant\/poor-house-bistro-91-s-autumn-st-san-jose\/399187?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=399187","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-42accc80f964a52051251fe3-4"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a821921f964a52095f81fe3","name":"A Slice of New York","contact":{},"location":{"address":"3443 Stevens Creek Blvd","crossStreet":"Cypress Ave","lat":37.32351925455433,"lng":-121.95904212650413,"labeledLatLngs":[{"label":"display","lat":37.32351925455433,"lng":-121.95904212650413}],"postalCode":"95117","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3443 Stevens Creek Blvd (Cypress Ave)","San Jose, CA 95117","United States"]},"categories":[{"id":"4bf58dd8d48988d1ca941735","name":"Pizza Place","pluralName":"Pizza Places","shortName":"Pizza","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/pizza_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a821921f964a52095f81fe3-5"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b6bd7def964a520381a2ce3","name":"Tony Di Maggio's Pizza","contact":{},"location":{"address":"3852 Monterey Hwy","lat":37.281746240000416,"lng":-121.83835946495479,"labeledLatLngs":[{"label":"display","lat":37.281746240000416,"lng":-121.83835946495479}],"postalCode":"95111","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3852 Monterey Hwy","San Jose, CA 95111","United States"]},"categories":[{"id":"4bf58dd8d48988d1ca941735","name":"Pizza Place","pluralName":"Pizza Places","shortName":"Pizza","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/pizza_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"61266514"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b6bd7def964a520381a2ce3-6"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e28d4e0b61c41a2f8a1c723","name":"La Cueva Mex Grill","contact":{},"location":{"address":"18486 Prospect Rd","lat":37.2914912169588,"lng":-121.9943769365165,"labeledLatLngs":[{"label":"display","lat":37.2914912169588,"lng":-121.9943769365165}],"postalCode":"95070","cc":"US","city":"Saratoga","state":"CA","country":"United States","formattedAddress":["18486 Prospect Rd","Saratoga, CA 95070","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e28d4e0b61c41a2f8a1c723-7"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4f20531be4b0bf85e373c1ae","name":"Souvlaki Greek Skewers","contact":{},"location":{"address":"577 W Alma Ave","lat":37.30935758735644,"lng":-121.88707760631867,"labeledLatLngs":[{"label":"display","lat":37.30935758735644,"lng":-121.88707760631867}],"postalCode":"95125","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["577 W Alma Ave","San Jose, CA 95125","United States"]},"categories":[{"id":"4bf58dd8d48988d10e941735","name":"Greek Restaurant","pluralName":"Greek Restaurants","shortName":"Greek","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/greek_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"1176242","url":"https:\/\/www.grubhub.com\/restaurant\/souvlaki-greek-skewers-577-w-alma-ave-san-jose\/1176242?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=1176242","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4f20531be4b0bf85e373c1ae-8"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b3b845cf964a520077525e3","name":"Big E Cafe Artisan Empanadas","contact":{},"location":{"address":"1683 Branham Ln","crossStreet":"Ross Ave.","lat":37.25276587127116,"lng":-121.90876744406256,"labeledLatLngs":[{"label":"display","lat":37.25276587127116,"lng":-121.90876744406256}],"postalCode":"95118","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1683 Branham Ln (Ross Ave.)","San Jose, CA 95118","United States"]},"categories":[{"id":"4eb1bfa43b7b52c0e1adc2e8","name":"Peruvian Restaurant","pluralName":"Peruvian Restaurants","shortName":"Peruvian","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/peruvian_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"33056053"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b3b845cf964a520077525e3-9"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4faabe59e4b092915bfa4229","name":"Back A Yard Caribbean American Grill","contact":{},"location":{"address":"80 N Market St","crossStreet":"btwn St. John & Santa Clara","lat":37.33668292139201,"lng":-121.89274947299549,"labeledLatLngs":[{"label":"display","lat":37.33668292139201,"lng":-121.89274947299549}],"postalCode":"95113","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["80 N Market St (btwn St. John & Santa Clara)","San Jose, CA 95113","United States"]},"categories":[{"id":"4bf58dd8d48988d144941735","name":"Caribbean Restaurant","pluralName":"Caribbean Restaurants","shortName":"Caribbean","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/caribbean_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4faabe59e4b092915bfa4229-10"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"50e796dbe4b01d00f27cc35b","name":"Sushi Kan","contact":{},"location":{"address":"1305 N 1st St","lat":37.360139188141,"lng":-121.90853789638969,"labeledLatLngs":[{"label":"display","lat":37.360139188141,"lng":-121.90853789638969}],"postalCode":"95112","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1305 N 1st St","San Jose, CA 95112","United States"]},"categories":[{"id":"4bf58dd8d48988d1d2941735","name":"Sushi Restaurant","pluralName":"Sushi Restaurants","shortName":"Sushi","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/sushi_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-50e796dbe4b01d00f27cc35b-11"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b4fa767f964a5205b0f27e3","name":"In-N-Out Burger","contact":{},"location":{"address":"550 Newhall Dr","crossStreet":"at Coleman Ave","lat":37.350240159900736,"lng":-121.92187174487069,"labeledLatLngs":[{"label":"display","lat":37.350240159900736,"lng":-121.92187174487069}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["550 Newhall Dr (at Coleman Ave)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d16c941735","name":"Burger Joint","pluralName":"Burger Joints","shortName":"Burgers","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/burger_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b4fa767f964a5205b0f27e3-12"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"53b739f0498e1b9ab96408aa","name":"Gio Cha Duc Huong Sandwich","contact":{},"location":{"address":"1020 Story Rd","lat":37.331458375519716,"lng":-121.85490625180428,"labeledLatLngs":[{"label":"display","lat":37.331458375519716,"lng":-121.85490625180428}],"postalCode":"95122","cc":"US","neighborhood":"Central San Jose","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1020 Story Rd","San Jose, CA 95122","United States"]},"categories":[{"id":"4bf58dd8d48988d14a941735","name":"Vietnamese Restaurant","pluralName":"Vietnamese Restaurants","shortName":"Vietnamese","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/vietnamese_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-53b739f0498e1b9ab96408aa-13"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a6baaf9f964a5208dcf1fe3","name":"Silicon Valley Capital Club","contact":{},"location":{"address":"50 W San Fernando St","lat":37.3339453,"lng":-121.8893173,"labeledLatLngs":[{"label":"display","lat":37.3339453,"lng":-121.8893173}],"postalCode":"95113","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["50 W San Fernando St","San Jose, CA 95113","United States"]},"categories":[{"id":"4bf58dd8d48988d1c4941735","name":"Restaurant","pluralName":"Restaurants","shortName":"Restaurant","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/default_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a6baaf9f964a5208dcf1fe3-14"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"5834c1c18ae3637f9e056f92","name":"Ike's Love & Sandwiches","contact":{},"location":{"address":"90 Skyport Dr","lat":37.365456971235346,"lng":-121.91579507168251,"labeledLatLngs":[{"label":"display","lat":37.365456971235346,"lng":-121.91579507168251}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["90 Skyport Dr","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d1c5941735","name":"Sandwich Place","pluralName":"Sandwich Places","shortName":"Sandwiches","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"342579","url":"https:\/\/www.grubhub.com\/restaurant\/ikes-love-and-sandwiches-90-skyport-drive-ste-150-san-jose\/342579?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=342579","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-5834c1c18ae3637f9e056f92-15"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e9cd8c92c5b8638e5363db3","name":"Zona Rosa","contact":{},"location":{"address":"1411 The Alameda","crossStreet":"at Lenzen Ave","lat":37.33307885406612,"lng":-121.91407261285651,"labeledLatLngs":[{"label":"display","lat":37.33307885406612,"lng":-121.91407261285651}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1411 The Alameda (at Lenzen Ave)","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"390163555"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e9cd8c92c5b8638e5363db3-16"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"5a79fe352a7ab67103b2cf13","name":"Mendocino Farms","contact":{},"location":{"address":"3090 Olsen Dr Ste 150","crossStreet":"Santana Row","lat":37.31917264984398,"lng":-121.94856999703804,"labeledLatLngs":[{"label":"display","lat":37.31917264984398,"lng":-121.94856999703804}],"postalCode":"95128","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3090 Olsen Dr Ste 150 (Santana Row)","San Jose, CA 95128","United States"]},"categories":[{"id":"4bf58dd8d48988d14e941735","name":"American Restaurant","pluralName":"American Restaurants","shortName":"American","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/default_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-5a79fe352a7ab67103b2cf13-17"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a7df106f964a52046f01fe3","name":"Cafe Rosalena","contact":{},"location":{"address":"1077 The Alameda","crossStreet":"at Race St","lat":37.3317567,"lng":-121.9112576,"labeledLatLngs":[{"label":"display","lat":37.3317567,"lng":-121.9112576}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1077 The Alameda (at Race St)","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c5941735","name":"Sandwich Place","pluralName":"Sandwich Places","shortName":"Sandwiches","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a7df106f964a52046f01fe3-18"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b2f98e0f964a520d1ec24e3","name":"Peters' Bakery","contact":{},"location":{"address":"3108 Alum Rock Ave","crossStreet":"at S White Rd","lat":37.36594435314043,"lng":-121.82751428607084,"labeledLatLngs":[{"label":"display","lat":37.36594435314043,"lng":-121.82751428607084}],"postalCode":"95127","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3108 Alum Rock Ave (at S White Rd)","San Jose, CA 95127","United States"]},"categories":[{"id":"4bf58dd8d48988d16a941735","name":"Bakery","pluralName":"Bakeries","shortName":"Bakery","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/bakery_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"56499466"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b2f98e0f964a520d1ec24e3-19"}]}]}};
        // fetch.mockResponseOnce(JSON.stringify(mockSuccessResponse));

        // let's mock the service call
        const params = {
            v: '20140806',
            ll: '-33.8670,151.1957',
            client_id: 'ALZGU5SYSDOTXYFFOR33BKOTFI431ZTBN32ELVKCCKNJ5WLH',
            client_secret: 'LV1UVS1UNSIQX4XPTAVIYSLUTLMPNHETJ4QUIBCG1VPBE05V'
        }

        const endPoint = 'https://api.foursquare.com/v2/venues/explore?client_id='+params.client_id+
            '&client_secret='+params.client_secret+
            '&v='+ params.v +
            '&limit=20&near='+ "Fremont" +
            '&query='+ "food";

        const mockJsonPromise = Promise.resolve(mockSuccessResponse); // 2
        const mockFetchPromise = Promise.resolve({ // 3
            json: () => mockJsonPromise,
        });
        jest.spyOn(global, 'fetch').mockImplementation(() => { return mockFetchPromise }); // 4

        // Act
        let component = mount(
            <Search />
        );
        expect((component).prop('state')).not.toEqual(null);

        // basic check
        expect(component.find('.location-query').text()).toEqual('');
        expect(component.find('.search-item').text()).toEqual('');
        expect(component.find('.searchbox-submitbtn').text()).toEqual('Search');

        // type in the text
        component.find('.location-query').simulate('change', {target: {name: 'zipCode', value: 'Fremont'}});
        component.find('.search-item').simulate('change', {target: {name: 'searchItem', value: 'food'}});

        // fetchPlaces("fremont","food") and check the return
        component.find('button').simulate('click');
        expect(component.state('loading')).toBe(true);
        expect(component).toMatchSnapshot();
        expect(global.fetch).toHaveBeenCalledTimes(1);
        expect(global.fetch).toHaveBeenCalledWith(endPoint);

    });


    it("let's click on search button with API status !200", () => {

        // define the response
        const mockSuccessResponse = {"meta":{"code":220,"requestId":"5de69942c546f3001bfcd205"},"response":{"suggestedFilters":{"header":"Tap to show:","filters":[{"name":"$-$$$$","key":"price"},{"name":"Open now","key":"openNow"}]},"geocode":{"what":"","where":"san jose","center":{"lat":37.33939,"lng":-121.89496},"displayString":"San Jose, CA, United States","cc":"US","geometry":{"bounds":{"ne":{"lat":37.469167999999996,"lng":-121.589153},"sw":{"lat":37.125515,"lng":-122.045672}}},"slug":"san-jose-california","longId":"72057594043320107"},"headerLocation":"San Jose","headerFullLocation":"San Jose","headerLocationGranularity":"city","query":"food","totalResults":234,"suggestedBounds":{"ne":{"lat":37.38664414646438,"lng":-121.81915828621537},"sw":{"lat":37.24639071530957,"lng":-122.00272068176893}},"groups":[{"type":"Recommended Places","name":"recommended","items":[{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"592f8c198173cb70120ff91f","name":"Luna Mexican Restaurant","contact":{},"location":{"address":"1495 The Alameda","lat":37.33393480457079,"lng":-121.91517987804323,"labeledLatLngs":[{"label":"display","lat":37.33393480457079,"lng":-121.91517987804323}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1495 The Alameda","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-592f8c198173cb70120ff91f-0"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e6750db152001e1f7122a11","name":"San Pedro Square Market","contact":{},"location":{"address":"87 N San Pedro St","crossStreet":"at W St John St","lat":37.33647957495977,"lng":-121.89440263934547,"labeledLatLngs":[{"label":"display","lat":37.33647957495977,"lng":-121.89440263934547}],"postalCode":"95110","cc":"US","neighborhood":"Downtown San Jose","city":"San Jose","state":"CA","country":"United States","formattedAddress":["87 N San Pedro St (at W St John St)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d120951735","name":"Food Court","pluralName":"Food Courts","shortName":"Food Court","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/shops\/food_foodcourt_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"91053438"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e6750db152001e1f7122a11-1"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4aeb3974f964a520d0bf21e3","name":"Antipastos by De Rose","contact":{},"location":{"address":"3454 McKee Rd","crossStreet":"at Kirk Ave","lat":37.3802689905028,"lng":-121.82750203146779,"labeledLatLngs":[{"label":"display","lat":37.3802689905028,"lng":-121.82750203146779}],"postalCode":"95127","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3454 McKee Rd (at Kirk Ave)","San Jose, CA 95127","United States"]},"categories":[{"id":"4bf58dd8d48988d146941735","name":"Deli \/ Bodega","pluralName":"Delis \/ Bodegas","shortName":"Deli \/ Bodega","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4aeb3974f964a520d0bf21e3-2"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4be9b466b3352d7f464e54d2","name":"Chez Sovan","contact":{},"location":{"address":"923 Oakland Rd","crossStreet":"at Madera Ave.","lat":37.35993556655387,"lng":-121.89130050787494,"labeledLatLngs":[{"label":"display","lat":37.35993556655387,"lng":-121.89130050787494}],"postalCode":"95112","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["923 Oakland Rd (at Madera Ave.)","San Jose, CA 95112","United States"]},"categories":[{"id":"4bf58dd8d48988d142941735","name":"Asian Restaurant","pluralName":"Asian Restaurants","shortName":"Asian","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/asian_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4be9b466b3352d7f464e54d2-3"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"42accc80f964a52051251fe3","name":"Poor House Bistro","contact":{},"location":{"address":"91 S Autumn St","crossStreet":"at W San Fernando St","lat":37.32965001194557,"lng":-121.90043081169512,"labeledLatLngs":[{"label":"display","lat":37.32965001194557,"lng":-121.90043081169512}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["91 S Autumn St (at W San Fernando St)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d17a941735","name":"Cajun \/ Creole Restaurant","pluralName":"Cajun \/ Creole Restaurants","shortName":"Cajun \/ Creole","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/cajun_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"399187","url":"https:\/\/www.grubhub.com\/restaurant\/poor-house-bistro-91-s-autumn-st-san-jose\/399187?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=399187","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-42accc80f964a52051251fe3-4"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a821921f964a52095f81fe3","name":"A Slice of New York","contact":{},"location":{"address":"3443 Stevens Creek Blvd","crossStreet":"Cypress Ave","lat":37.32351925455433,"lng":-121.95904212650413,"labeledLatLngs":[{"label":"display","lat":37.32351925455433,"lng":-121.95904212650413}],"postalCode":"95117","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3443 Stevens Creek Blvd (Cypress Ave)","San Jose, CA 95117","United States"]},"categories":[{"id":"4bf58dd8d48988d1ca941735","name":"Pizza Place","pluralName":"Pizza Places","shortName":"Pizza","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/pizza_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a821921f964a52095f81fe3-5"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b6bd7def964a520381a2ce3","name":"Tony Di Maggio's Pizza","contact":{},"location":{"address":"3852 Monterey Hwy","lat":37.281746240000416,"lng":-121.83835946495479,"labeledLatLngs":[{"label":"display","lat":37.281746240000416,"lng":-121.83835946495479}],"postalCode":"95111","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3852 Monterey Hwy","San Jose, CA 95111","United States"]},"categories":[{"id":"4bf58dd8d48988d1ca941735","name":"Pizza Place","pluralName":"Pizza Places","shortName":"Pizza","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/pizza_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"61266514"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b6bd7def964a520381a2ce3-6"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e28d4e0b61c41a2f8a1c723","name":"La Cueva Mex Grill","contact":{},"location":{"address":"18486 Prospect Rd","lat":37.2914912169588,"lng":-121.9943769365165,"labeledLatLngs":[{"label":"display","lat":37.2914912169588,"lng":-121.9943769365165}],"postalCode":"95070","cc":"US","city":"Saratoga","state":"CA","country":"United States","formattedAddress":["18486 Prospect Rd","Saratoga, CA 95070","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e28d4e0b61c41a2f8a1c723-7"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4f20531be4b0bf85e373c1ae","name":"Souvlaki Greek Skewers","contact":{},"location":{"address":"577 W Alma Ave","lat":37.30935758735644,"lng":-121.88707760631867,"labeledLatLngs":[{"label":"display","lat":37.30935758735644,"lng":-121.88707760631867}],"postalCode":"95125","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["577 W Alma Ave","San Jose, CA 95125","United States"]},"categories":[{"id":"4bf58dd8d48988d10e941735","name":"Greek Restaurant","pluralName":"Greek Restaurants","shortName":"Greek","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/greek_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"1176242","url":"https:\/\/www.grubhub.com\/restaurant\/souvlaki-greek-skewers-577-w-alma-ave-san-jose\/1176242?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=1176242","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4f20531be4b0bf85e373c1ae-8"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b3b845cf964a520077525e3","name":"Big E Cafe Artisan Empanadas","contact":{},"location":{"address":"1683 Branham Ln","crossStreet":"Ross Ave.","lat":37.25276587127116,"lng":-121.90876744406256,"labeledLatLngs":[{"label":"display","lat":37.25276587127116,"lng":-121.90876744406256}],"postalCode":"95118","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1683 Branham Ln (Ross Ave.)","San Jose, CA 95118","United States"]},"categories":[{"id":"4eb1bfa43b7b52c0e1adc2e8","name":"Peruvian Restaurant","pluralName":"Peruvian Restaurants","shortName":"Peruvian","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/peruvian_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"33056053"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b3b845cf964a520077525e3-9"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4faabe59e4b092915bfa4229","name":"Back A Yard Caribbean American Grill","contact":{},"location":{"address":"80 N Market St","crossStreet":"btwn St. John & Santa Clara","lat":37.33668292139201,"lng":-121.89274947299549,"labeledLatLngs":[{"label":"display","lat":37.33668292139201,"lng":-121.89274947299549}],"postalCode":"95113","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["80 N Market St (btwn St. John & Santa Clara)","San Jose, CA 95113","United States"]},"categories":[{"id":"4bf58dd8d48988d144941735","name":"Caribbean Restaurant","pluralName":"Caribbean Restaurants","shortName":"Caribbean","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/caribbean_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4faabe59e4b092915bfa4229-10"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"50e796dbe4b01d00f27cc35b","name":"Sushi Kan","contact":{},"location":{"address":"1305 N 1st St","lat":37.360139188141,"lng":-121.90853789638969,"labeledLatLngs":[{"label":"display","lat":37.360139188141,"lng":-121.90853789638969}],"postalCode":"95112","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1305 N 1st St","San Jose, CA 95112","United States"]},"categories":[{"id":"4bf58dd8d48988d1d2941735","name":"Sushi Restaurant","pluralName":"Sushi Restaurants","shortName":"Sushi","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/sushi_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-50e796dbe4b01d00f27cc35b-11"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b4fa767f964a5205b0f27e3","name":"In-N-Out Burger","contact":{},"location":{"address":"550 Newhall Dr","crossStreet":"at Coleman Ave","lat":37.350240159900736,"lng":-121.92187174487069,"labeledLatLngs":[{"label":"display","lat":37.350240159900736,"lng":-121.92187174487069}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["550 Newhall Dr (at Coleman Ave)","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d16c941735","name":"Burger Joint","pluralName":"Burger Joints","shortName":"Burgers","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/burger_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b4fa767f964a5205b0f27e3-12"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"53b739f0498e1b9ab96408aa","name":"Gio Cha Duc Huong Sandwich","contact":{},"location":{"address":"1020 Story Rd","lat":37.331458375519716,"lng":-121.85490625180428,"labeledLatLngs":[{"label":"display","lat":37.331458375519716,"lng":-121.85490625180428}],"postalCode":"95122","cc":"US","neighborhood":"Central San Jose","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1020 Story Rd","San Jose, CA 95122","United States"]},"categories":[{"id":"4bf58dd8d48988d14a941735","name":"Vietnamese Restaurant","pluralName":"Vietnamese Restaurants","shortName":"Vietnamese","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/vietnamese_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-53b739f0498e1b9ab96408aa-13"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a6baaf9f964a5208dcf1fe3","name":"Silicon Valley Capital Club","contact":{},"location":{"address":"50 W San Fernando St","lat":37.3339453,"lng":-121.8893173,"labeledLatLngs":[{"label":"display","lat":37.3339453,"lng":-121.8893173}],"postalCode":"95113","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["50 W San Fernando St","San Jose, CA 95113","United States"]},"categories":[{"id":"4bf58dd8d48988d1c4941735","name":"Restaurant","pluralName":"Restaurants","shortName":"Restaurant","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/default_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a6baaf9f964a5208dcf1fe3-14"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"5834c1c18ae3637f9e056f92","name":"Ike's Love & Sandwiches","contact":{},"location":{"address":"90 Skyport Dr","lat":37.365456971235346,"lng":-121.91579507168251,"labeledLatLngs":[{"label":"display","lat":37.365456971235346,"lng":-121.91579507168251}],"postalCode":"95110","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["90 Skyport Dr","San Jose, CA 95110","United States"]},"categories":[{"id":"4bf58dd8d48988d1c5941735","name":"Sandwich Place","pluralName":"Sandwich Places","shortName":"Sandwiches","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"delivery":{"id":"342579","url":"https:\/\/www.grubhub.com\/restaurant\/ikes-love-and-sandwiches-90-skyport-drive-ste-150-san-jose\/342579?affiliate=1131&utm_source=foursquare-affiliate-network&utm_medium=affiliate&utm_campaign=1131&utm_content=342579","provider":{"name":"grubhub","icon":{"prefix":"https:\/\/fastly.4sqi.net\/img\/general\/cap\/","sizes":[40,50],"name":"\/delivery_provider_grubhub_20180129.png"}}},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-5834c1c18ae3637f9e056f92-15"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4e9cd8c92c5b8638e5363db3","name":"Zona Rosa","contact":{},"location":{"address":"1411 The Alameda","crossStreet":"at Lenzen Ave","lat":37.33307885406612,"lng":-121.91407261285651,"labeledLatLngs":[{"label":"display","lat":37.33307885406612,"lng":-121.91407261285651}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1411 The Alameda (at Lenzen Ave)","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c1941735","name":"Mexican Restaurant","pluralName":"Mexican Restaurants","shortName":"Mexican","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/mexican_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"390163555"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4e9cd8c92c5b8638e5363db3-16"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"5a79fe352a7ab67103b2cf13","name":"Mendocino Farms","contact":{},"location":{"address":"3090 Olsen Dr Ste 150","crossStreet":"Santana Row","lat":37.31917264984398,"lng":-121.94856999703804,"labeledLatLngs":[{"label":"display","lat":37.31917264984398,"lng":-121.94856999703804}],"postalCode":"95128","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3090 Olsen Dr Ste 150 (Santana Row)","San Jose, CA 95128","United States"]},"categories":[{"id":"4bf58dd8d48988d14e941735","name":"American Restaurant","pluralName":"American Restaurants","shortName":"American","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/default_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-5a79fe352a7ab67103b2cf13-17"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4a7df106f964a52046f01fe3","name":"Cafe Rosalena","contact":{},"location":{"address":"1077 The Alameda","crossStreet":"at Race St","lat":37.3317567,"lng":-121.9112576,"labeledLatLngs":[{"label":"display","lat":37.3317567,"lng":-121.9112576}],"postalCode":"95126","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["1077 The Alameda (at Race St)","San Jose, CA 95126","United States"]},"categories":[{"id":"4bf58dd8d48988d1c5941735","name":"Sandwich Place","pluralName":"Sandwich Places","shortName":"Sandwiches","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/deli_","suffix":".png"},"primary":true}],"verified":false,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4a7df106f964a52046f01fe3-18"},{"reasons":{"count":0,"items":[{"summary":"This spot is popular","type":"general","reasonName":"globalInteractionReason"}]},"venue":{"id":"4b2f98e0f964a520d1ec24e3","name":"Peters' Bakery","contact":{},"location":{"address":"3108 Alum Rock Ave","crossStreet":"at S White Rd","lat":37.36594435314043,"lng":-121.82751428607084,"labeledLatLngs":[{"label":"display","lat":37.36594435314043,"lng":-121.82751428607084}],"postalCode":"95127","cc":"US","city":"San Jose","state":"CA","country":"United States","formattedAddress":["3108 Alum Rock Ave (at S White Rd)","San Jose, CA 95127","United States"]},"categories":[{"id":"4bf58dd8d48988d16a941735","name":"Bakery","pluralName":"Bakeries","shortName":"Bakery","icon":{"prefix":"https:\/\/ss3.4sqi.net\/img\/categories_v2\/food\/bakery_","suffix":".png"},"primary":true}],"verified":true,"stats":{"tipCount":0,"usersCount":0,"checkinsCount":0,"visitsCount":0},"beenHere":{"count":0,"lastCheckinExpiredAt":0,"marked":false,"unconfirmedCount":0},"photos":{"count":0,"groups":[]},"venuePage":{"id":"56499466"},"hereNow":{"count":0,"summary":"Nobody here","groups":[]}},"referralId":"e-0-4b2f98e0f964a520d1ec24e3-19"}]}]}};
        // fetch.mockResponseOnce(JSON.stringify(mockSuccessResponse));

        // let's mock the service call
        const params = {
            v: '20140806',
            ll: '-33.8670,151.1957',
            client_id: 'ALZGU5SYSDOTXYFFOR33BKOTFI431ZTBN32ELVKCCKNJ5WLH',
            client_secret: 'LV1UVS1UNSIQX4XPTAVIYSLUTLMPNHETJ4QUIBCG1VPBE05V'
        }

        const endPoint = 'https://api.foursquare.com/v2/venues/explore?client_id='+params.client_id+
            '&client_secret='+params.client_secret+
            '&v='+ params.v +
            '&limit=20&near='+ "Fremont" +
            '&query='+ "food";

        const mockJsonPromise = Promise.resolve(mockSuccessResponse); // 2
        const mockFetchPromise = Promise.resolve({ // 3
            json: () => mockJsonPromise,
        });
        jest.spyOn(global, 'fetch').mockImplementation(() => { return mockFetchPromise }); // 4

        // Act
        let component = mount(
            <Search />
        );
        expect((component).prop('state')).not.toEqual(null);

        // basic check
        expect(component.find('.location-query').text()).toEqual('');
        expect(component.find('.search-item').text()).toEqual('');
        expect(component.find('.searchbox-submitbtn').text()).toEqual('Search');

        // type in the text
        component.find('.location-query').simulate('change', {target: {name: 'zipCode', value: 'Fremont'}});
        component.find('.search-item').simulate('change', {target: {name: 'searchItem', value: 'food'}});

        // fetchPlaces("fremont","food") and check the return
        try {
            component.find('button').simulate('click');
            expect(component.state('loading')).toBe(true);
        } catch(err) {
            console.log(".....");
            if(!err) {
                expect.fail();
            } else {
               console.log('...thrown...');
            }
        }


    });

});

